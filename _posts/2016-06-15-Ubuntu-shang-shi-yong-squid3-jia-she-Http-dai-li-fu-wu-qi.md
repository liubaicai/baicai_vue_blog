---
layout:     post
title:      "Ubuntu 上使用 squid3 架设Http代理服务器"
date:       2016-06-15 09:27:16 UTC
author:     "baicai"
catalog: true
tags:
    - 存档
---

<p>安装</p><p>$sudo apt-get install squid</p><p><br></p><p>配置 squid3</p><p>$sudo vim /etc/squid3/squid.conf</p><p><br></p><p>添加用户名验证（下面）&lt;/p><p><br></p><p>启动/重启 squid3</p><p>$sudo service squid3 restart</p><p><br></p><p>注意： squid的 http默认代理端口为 3128</p><p><br></p><p>



          

      



                        

       

     

         <!--new top-->                         <!--new top-->           <!-- ad begin -->          

     <!-- ad end-->                      

































</p><div id="container"><div id="body"><div id="main"><div class="main"><div class="details" id="article_details"><div class="article_content" id="article_content"><!--StartFragment--><p>安装了Squid后会有一些不明的流量和CPU占用95%以上，估计是因为没加密码，被扫描到端口后被滥用。&lt;/p><p>我们给Squid代理添加用户、密码认证。&lt;/p><p><span style="font-size: 18px;">1、密码用apache2自带的NCSA&nbsp;</span></p><p>先做个密码档，然后设为任何人可读：&lt;/p><div class="dp-highlighter bg_objc"><div class="bar"><div class="tools"><b>[objc]</b> <a title="view plain" class="ViewSource" href="http://blog.csdn.net/skylinethj/article/details/43837277#">view plain</a><span data-mod="popu_168"> <a title="copy" class="CopyToClipboard" href="http://blog.csdn.net/skylinethj/article/details/43837277#">copy</a></span><span data-mod="popu_169"> <a title="print" class="PrintSource" href="http://blog.csdn.net/skylinethj/article/details/43837277#">print</a></span><a title="?" class="About" href="http://blog.csdn.net/skylinethj/article/details/43837277#">?</a><span class="tracking-ad" data-mod="popu_167"><a title="在CODE上查看代码片" href="https://code.csdn.net/snippets/605255" target="_blank"><img width="12" height="12" style="left: 2px; top: 1px; position: relative;" alt="在CODE上查看代码片" src="https://code.csdn.net/assets/CODE_ico.png"></a></span><span class="tracking-ad" data-mod="popu_170"><a title="派生到我的代码片" href="https://code.csdn.net/snippets/605255/fork" target="_blank"><img width="12" height="12" style="left: 2px; top: 2px; position: relative;" alt="派生到我的代码片" src="https://code.csdn.net/assets/ico_fork.svg"></a></span></div></div><ol class="dp-objc"><li class="alt">sudo&nbsp;touch&nbsp;/etc/squid<span class="xcodenumber">3</span>/squid_passwd&nbsp;&nbsp;</li><li>sudo&nbsp;chmod&nbsp;-R&nbsp;<span class="xcodenumber">7</span><span class="xcodenumber">7</span><span class="xcodenumber">7</span>&nbsp;/etc/squid<span class="xcodenumber">3</span>/squid_passwd&nbsp;&nbsp;</li></ol></div><pre class="objc" style="display: none;" name="code" snippet_file_name="blog_20150215_1_6897288" code_snippet_id="605255">sudo touch /etc/squid3/squid_passwd
sudo chmod -R 777 /etc/squid3/squid_passwd</pre>// 这些路径可以自定义，只要下面的配置能对应上就行。&lt;br> 给密码文件授权&lt;br><p></p><div class="dp-highlighter bg_objc"><div class="bar"><div class="tools"><b>[objc]</b> <a title="view plain" class="ViewSource" href="http://blog.csdn.net/skylinethj/article/details/43837277#">view plain</a><span data-mod="popu_168"> <a title="copy" class="CopyToClipboard" href="http://blog.csdn.net/skylinethj/article/details/43837277#">copy</a></span><span data-mod="popu_169"> <a title="print" class="PrintSource" href="http://blog.csdn.net/skylinethj/article/details/43837277#">print</a></span><a title="?" class="About" href="http://blog.csdn.net/skylinethj/article/details/43837277#">?</a><span class="tracking-ad" data-mod="popu_167"><a title="在CODE上查看代码片" href="https://code.csdn.net/snippets/605255" target="_blank"><img width="12" height="12" style="left: 2px; top: 1px; position: relative;" alt="在CODE上查看代码片" src="https://code.csdn.net/assets/CODE_ico.png"></a></span><span class="tracking-ad" data-mod="popu_170"><a title="派生到我的代码片" href="https://code.csdn.net/snippets/605255/fork" target="_blank"><img width="12" height="12" style="left: 2px; top: 2px; position: relative;" alt="派生到我的代码片" src="https://code.csdn.net/assets/ico_fork.svg"></a></span></div></div><ol class="dp-objc"><li class="alt">sudo&nbsp;htpasswd&nbsp;/etc/squid<span class="xcodenumber">3</span>/squid_passwd&nbsp;testname&nbsp;&nbsp;</li></ol></div><pre class="objc" style="display: none;" name="code" snippet_file_name="blog_20150215_2_9324950" code_snippet_id="605255">sudo htpasswd /etc/squid3/squid_passwd testname</pre><p></p><p>testname 是使用者名称。然后系统会要求输入密码。&lt;/p><br><span style="font-size: 18px;">2、修改squid_conf</span><br><br>在 337行左右 加入<br><div class="dp-highlighter bg_objc"><div class="bar"><div class="tools"><b>[objc]</b> <a title="view plain" class="ViewSource" href="http://blog.csdn.net/skylinethj/article/details/43837277#">view plain</a><span data-mod="popu_168"> <a title="copy" class="CopyToClipboard" href="http://blog.csdn.net/skylinethj/article/details/43837277#">copy</a></span><span data-mod="popu_169"> <a title="print" class="PrintSource" href="http://blog.csdn.net/skylinethj/article/details/43837277#">print</a></span><a title="?" class="About" href="http://blog.csdn.net/skylinethj/article/details/43837277#">?</a><span class="tracking-ad" data-mod="popu_167"><a title="在CODE上查看代码片" href="https://code.csdn.net/snippets/605255" target="_blank"><img width="12" height="12" style="left: 2px; top: 1px; position: relative;" alt="在CODE上查看代码片" src="https://code.csdn.net/assets/CODE_ico.png"></a></span><span class="tracking-ad" data-mod="popu_170"><a title="派生到我的代码片" href="https://code.csdn.net/snippets/605255/fork" target="_blank"><img width="12" height="12" style="left: 2px; top: 2px; position: relative;" alt="派生到我的代码片" src="https://code.csdn.net/assets/ico_fork.svg"></a></span></div></div><ol class="dp-objc"><li class="alt">auth_param&nbsp;basic&nbsp;program&nbsp;/usr/lib/squid<span class="xcodenumber">3</span>/ncsa_auth&nbsp;/etc/squid<span class="xcodenumber">3</span>/squid_passwd&nbsp;&nbsp;</li></ol></div><pre class="objc" style="display: none;" name="code" snippet_file_name="blog_20150215_3_4044283" code_snippet_id="605255">auth_param basic program /usr/lib/squid3/ncsa_auth /etc/squid3/squid_passwd</pre><p>// 上面这行需要注意，我搞了很久才发现这里出问题的，ncsa_auth的路径要找到自己安装的地方。一般在/usr/lib/squid/或者/usr/lib/squid3/视版本而定。&lt;/p><p><br></p>在 720 行左右加入&lt;br><div class="dp-highlighter bg_objc"><div class="bar"><div class="tools"><b>[objc]</b> <a title="view plain" class="ViewSource" href="http://blog.csdn.net/skylinethj/article/details/43837277#">view plain</a><span data-mod="popu_168"> <a title="copy" class="CopyToClipboard" href="http://blog.csdn.net/skylinethj/article/details/43837277#">copy</a></span><span data-mod="popu_169"> <a title="print" class="PrintSource" href="http://blog.csdn.net/skylinethj/article/details/43837277#">print</a></span><a title="?" class="About" href="http://blog.csdn.net/skylinethj/article/details/43837277#">?</a><span class="tracking-ad" data-mod="popu_167"><a title="在CODE上查看代码片" href="https://code.csdn.net/snippets/605255" target="_blank"><img width="12" height="12" style="left: 2px; top: 1px; position: relative;" alt="在CODE上查看代码片" src="https://code.csdn.net/assets/CODE_ico.png"></a></span><span class="tracking-ad" data-mod="popu_170"><a title="派生到我的代码片" href="https://code.csdn.net/snippets/605255/fork" target="_blank"><img width="12" height="12" style="left: 2px; top: 2px; position: relative;" alt="派生到我的代码片" src="https://code.csdn.net/assets/ico_fork.svg"></a></span></div></div><ol class="dp-objc"><li class="alt">acl&nbsp;ncsa_users&nbsp;proxy_auth&nbsp;REQUIRED&nbsp;&nbsp;</li></ol></div><pre class="objc" style="display: none;" name="code" snippet_file_name="blog_20150215_4_5416328" code_snippet_id="605255">acl ncsa_users proxy_auth REQUIRED</pre><br>在 793行左右 加入<br><div class="dp-highlighter bg_objc"><div class="bar"><div class="tools"><b>[objc]</b> <a title="view plain" class="ViewSource" href="http://blog.csdn.net/skylinethj/article/details/43837277#">view plain</a><span data-mod="popu_168"> <a title="copy" class="CopyToClipboard" href="http://blog.csdn.net/skylinethj/article/details/43837277#">copy</a></span><span data-mod="popu_169"> <a title="print" class="PrintSource" href="http://blog.csdn.net/skylinethj/article/details/43837277#">print</a></span><a title="?" class="About" href="http://blog.csdn.net/skylinethj/article/details/43837277#">?</a><span class="tracking-ad" data-mod="popu_167"><a title="在CODE上查看代码片" href="https://code.csdn.net/snippets/605255" target="_blank"><img width="12" height="12" style="left: 2px; top: 1px; position: relative;" alt="在CODE上查看代码片" src="https://code.csdn.net/assets/CODE_ico.png"></a></span><span class="tracking-ad" data-mod="popu_170"><a title="派生到我的代码片" href="https://code.csdn.net/snippets/605255/fork" target="_blank"><img width="12" height="12" style="left: 2px; top: 2px; position: relative;" alt="派生到我的代码片" src="https://code.csdn.net/assets/ico_fork.svg"></a></span></div></div><ol class="dp-objc"><li class="alt">http_acecss&nbsp;allow&nbsp;ncsa_users&nbsp;&nbsp;</li></ol></div><pre class="objc" style="display: none;" name="code" snippet_file_name="blog_20150215_5_5675558" code_snippet_id="605255">http_acecss allow ncsa_users</pre><br>把843，844行的<br><div class="dp-highlighter bg_objc"><div class="bar"><div class="tools"><b>[objc]</b> <a title="view plain" class="ViewSource" href="http://blog.csdn.net/skylinethj/article/details/43837277#">view plain</a><span data-mod="popu_168"> <a title="copy" class="CopyToClipboard" href="http://blog.csdn.net/skylinethj/article/details/43837277#">copy</a></span><span data-mod="popu_169"> <a title="print" class="PrintSource" href="http://blog.csdn.net/skylinethj/article/details/43837277#">print</a></span><a title="?" class="About" href="http://blog.csdn.net/skylinethj/article/details/43837277#">?</a><span class="tracking-ad" data-mod="popu_167"><a title="在CODE上查看代码片" href="https://code.csdn.net/snippets/605255" target="_blank"><img width="12" height="12" style="left: 2px; top: 1px; position: relative;" alt="在CODE上查看代码片" src="https://code.csdn.net/assets/CODE_ico.png"></a></span><span class="tracking-ad" data-mod="popu_170"><a title="派生到我的代码片" href="https://code.csdn.net/snippets/605255/fork" target="_blank"><img width="12" height="12" style="left: 2px; top: 2px; position: relative;" alt="派生到我的代码片" src="https://code.csdn.net/assets/ico_fork.svg"></a></span></div></div><ol class="dp-objc"><li class="alt">http_access&nbsp;allow&nbsp;localnet&nbsp;,&nbsp;http_access&nbsp;allos&nbsp;localhost屏蔽掉。&amp;nbsp;&nbsp;</li></ol></div><pre class="objc" style="display: none;" name="code" snippet_file_name="blog_20150215_6_4331605" code_snippet_id="605255">http_access allow localnet , http_access allos localhost屏蔽掉。&lt;/pre><br><span style="font-size: 18px;">3、重新启动squid3</span><br><div class="dp-highlighter bg_objc"><div class="bar"><div class="tools"><b>[objc]</b> <a title="view plain" class="ViewSource" href="http://blog.csdn.net/skylinethj/article/details/43837277#">view plain</a><span data-mod="popu_168"> <a title="copy" class="CopyToClipboard" href="http://blog.csdn.net/skylinethj/article/details/43837277#">copy</a></span><span data-mod="popu_169"> <a title="print" class="PrintSource" href="http://blog.csdn.net/skylinethj/article/details/43837277#">print</a></span><a title="?" class="About" href="http://blog.csdn.net/skylinethj/article/details/43837277#">?</a><span class="tracking-ad" data-mod="popu_167"><a title="在CODE上查看代码片" href="https://code.csdn.net/snippets/605255" target="_blank"><img width="12" height="12" style="left: 2px; top: 1px; position: relative;" alt="在CODE上查看代码片" src="https://code.csdn.net/assets/CODE_ico.png"></a></span><span class="tracking-ad" data-mod="popu_170"><a title="派生到我的代码片" href="https://code.csdn.net/snippets/605255/fork" target="_blank"><img width="12" height="12" style="left: 2px; top: 2px; position: relative;" alt="派生到我的代码片" src="https://code.csdn.net/assets/ico_fork.svg"></a></span></div></div><ol class="dp-objc"><li class="alt">sudo&nbsp;service&nbsp;squid<span class="xcodenumber">3</span>&nbsp;--full-restart&nbsp;或者&amp;nbsp;&lt;span&nbsp;style=<span class="string">"font-family:&nbsp;monospace;&nbsp;line-height:&nbsp;18px;&nbsp;background-color:&nbsp;rgb(239,&nbsp;243,&nbsp;251);"</span>&gt;sudo&nbsp;/etc/init<span class="xcodeconstants">.d</span>/squid&nbsp;restart&lt;/span&gt;&nbsp;&nbsp;</li></ol></div><pre class="objc" style="display: none;" name="code" snippet_file_name="blog_20150215_7_5147242" code_snippet_id="605255">sudo service squid3 --full-restart 或者 &lt;span style="font-family: monospace; line-height: 18px; background-color: rgb(239, 243, 251);"&gt;sudo /etc/init.d/squid restart&lt;/span&gt;</pre><p>或者让配置生效就行</p><p></p><div class="dp-highlighter bg_objc"><div class="bar"><div class="tools"><b>[objc]</b> <a title="view plain" class="ViewSource" href="http://blog.csdn.net/skylinethj/article/details/43837277#">view plain</a><span data-mod="popu_168"> <a title="copy" class="CopyToClipboard" href="http://blog.csdn.net/skylinethj/article/details/43837277#">copy</a></span><span data-mod="popu_169"> <a title="print" class="PrintSource" href="http://blog.csdn.net/skylinethj/article/details/43837277#">print</a></span><a title="?" class="About" href="http://blog.csdn.net/skylinethj/article/details/43837277#">?</a><span class="tracking-ad" data-mod="popu_167"><a title="在CODE上查看代码片" href="https://code.csdn.net/snippets/605255" target="_blank"><img width="12" height="12" style="left: 2px; top: 1px; position: relative;" alt="在CODE上查看代码片" src="https://code.csdn.net/assets/CODE_ico.png"></a></span><span class="tracking-ad" data-mod="popu_170"><a title="派生到我的代码片" href="https://code.csdn.net/snippets/605255/fork" target="_blank"><img width="12" height="12" style="left: 2px; top: 2px; position: relative;" alt="派生到我的代码片" src="https://code.csdn.net/assets/ico_fork.svg"></a></span></div></div><ol class="dp-objc"><li class="alt">sudo&nbsp;service&nbsp;squid<span class="xcodenumber">3</span>&nbsp;-k&nbsp;reconfig&nbsp;&nbsp;</li></ol></div><pre class="objc" style="display: none;" name="code" snippet_file_name="blog_20150215_8_5439492" code_snippet_id="605255">sudo service squid3 -k reconfig</pre><br><p></p><span style="font-size: 18px;">4、进阶&lt;/span><br> 一些更完善的参数，当然不是必须的可以不需要&lt;br><div class="dp-highlighter bg_objc"><div class="bar"><div class="tools"><b>[objc]</b> <a title="view plain" class="ViewSource" href="http://blog.csdn.net/skylinethj/article/details/43837277#">view plain</a><span data-mod="popu_168"> <a title="copy" class="CopyToClipboard" href="http://blog.csdn.net/skylinethj/article/details/43837277#">copy</a></span><span data-mod="popu_169"> <a title="print" class="PrintSource" href="http://blog.csdn.net/skylinethj/article/details/43837277#">print</a></span><a title="?" class="About" href="http://blog.csdn.net/skylinethj/article/details/43837277#">?</a><span class="tracking-ad" data-mod="popu_167"><a title="在CODE上查看代码片" href="https://code.csdn.net/snippets/605255" target="_blank"><img width="12" height="12" style="left: 2px; top: 1px; position: relative;" alt="在CODE上查看代码片" src="https://code.csdn.net/assets/CODE_ico.png"></a></span><span class="tracking-ad" data-mod="popu_170"><a title="派生到我的代码片" href="https://code.csdn.net/snippets/605255/fork" target="_blank"><img width="12" height="12" style="left: 2px; top: 2px; position: relative;" alt="派生到我的代码片" src="https://code.csdn.net/assets/ico_fork.svg"></a></span></div></div><ol class="dp-objc"><li class="alt">auth_param&nbsp;basic&nbsp;children&nbsp;<span class="xcodenumber">5</span>&nbsp;&nbsp;</li><li>auth_param&nbsp;basic&nbsp;realm&nbsp;Squid&nbsp;proxy-caching&nbsp;web&nbsp;server&nbsp;&nbsp;</li><li class="alt">auth_param&nbsp;basic&nbsp;credentialsttl&nbsp;<span class="xcodenumber">2</span>&nbsp;hours&nbsp;&nbsp;</li><li>auth_param&nbsp;basic&nbsp;casesensitive&nbsp;off &nbsp;</li></ol></div><!--EndFragment--></div></div></div></div></div></div>