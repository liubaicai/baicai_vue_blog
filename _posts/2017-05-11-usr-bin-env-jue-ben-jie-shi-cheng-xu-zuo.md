---
layout:     post
title:      "#! /usr/bin/env 脚本解释程序的作用"
date:       2017-05-11 06:26:10 UTC
author:     "baicai"
catalog: true
tags:
    - 存档
---

<p></p><pre><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">#!/usr/bin/env&nbsp;</span></pre><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">在linux的一些bash的脚本，需在开头一行指定脚本的解释程序，如：&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><pre><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">#!/usr/bin/env python&nbsp;</span></pre><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">再如：&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><pre><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">#!/usr/bin/env perl&nbsp;<br></span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">#!/usr/bin/env zimbu&nbsp;<br></span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">#!/usr/bin/env ruby&nbsp;</span></pre><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">但有时候也用&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><pre><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">#!/usr/bin/python&nbsp;</span></pre><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">和&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><pre><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">#!/usr/bin/perl&nbsp;</span></pre><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">那么 env到底有什么用？何时用这个呢？&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">&nbsp;&nbsp;&nbsp; 脚本用env启动的原因，是因为脚本解释器在linux中可能被安装于不同的目录，env可以在系统的PATH目录中查找。同时，env还规定一些系统环境变量。&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">如我系统里env程序执行后打印结果：&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><pre><font face="Helvetica, Tahoma, Arial, sans-serif">mac@macmbp ~&gt; env
Apple_PubSub_Socket_Render=/private/tmp/com.apple.launchd.WHGWRJgv3D/Render
HOME=/Users/mac
LANG=zh_CN.UTF-8
LOGNAME=mac
PATH=/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/go/bin
PWD=/Users/mac
SHELL=/bin/bash
SHLVL=1
SSH_AUTH_SOCK=/private/tmp/com.apple.launchd.NSsrdPru5h/Listeners
TERM=xterm-256color
TERM_PROGRAM=Apple_Terminal
TERM_PROGRAM_VERSION=388.1
TERM_SESSION_ID=13ADC3CB-DE48-4ADE-B9AB-0BF0E5D45454
TMPDIR=/var/folders/ml/b32sv3j51m99nh7xvczpn81r0000gn/T/
USER=mac
XPC_FLAGS=0x0
XPC_SERVICE_NAME=0
__CF_USER_TEXT_ENCODING=0x1F5:0x19:0x34
__fish_bin_dir=/usr/local/Cellar/fish/2.2.0/bin
__fish_datadir=/usr/local/Cellar/fish/2.2.0/share/fish
__fish_help_dir=/usr/local/Cellar/fish/2.2.0/share/doc/fish
__fish_sysconfdir=/usr/local/Cellar/fish/2.2.0/etc/fish</font></pre><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">可以用env来执行程序：&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><pre><font face="Helvetica, Tahoma, Arial, sans-serif">mac@macmbp ~&gt; env ruby -v
ruby 2.3.4p301 (2017-03-30 revision 58214) [x86_64-darwin16]</font><br></pre><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">而如果直接将解释器路径写死在脚本里，可能在某些系统就会存在找不到解释器的兼容性问题。有时候我们执行一些脚本时就碰到这种情况。&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">话说，vim作者Bram Moolenaar推出了一种脚本语言叫zimbu，放在google code上。&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">地址：http://code.google.com/p/zimbu/&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">下载编译后，执行它的示例程序，报错：&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><pre><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">zhouhh@zhh64:~/zimbu$ cat hello.zu&nbsp;<br></span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">#!/usr/bin/env zimbush&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">FUNC int MAIN()&nbsp;<br></span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">&nbsp; IO.write("Hello World!\n")&nbsp;<br></span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">&nbsp; RETURN 0&nbsp;<br></span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">}&nbsp;<br></span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">zhouhh@zhh64:~/zimbu$ ./hello.zu&nbsp;</span></pre><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">/usr/bin/env: zimbush: 没有那个文件或目录&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">显然没有设置环境变量。&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">Probably the most common use of env is to find the correct interpreter&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">&nbsp;&nbsp;&nbsp;&nbsp; for a script, when the interpreter may be in different directories on&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">&nbsp;&nbsp;&nbsp;&nbsp; different systems.&nbsp; The following example will find the `perl' inter-&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">&nbsp;&nbsp;&nbsp;&nbsp; preter by searching through the directories specified by PATH.&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><pre><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #!/usr/bin/env perl&nbsp;</span></pre><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">&nbsp;&nbsp;&nbsp;&nbsp; One limitation of that example is that it assumes the user's value for&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">&nbsp;&nbsp;&nbsp;&nbsp; PATH is set to a value which will find the interpreter you want to exe-&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">&nbsp;&nbsp;&nbsp;&nbsp; cute.&nbsp; The -P option can be used to make sure a specific list of directo-&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">&nbsp;&nbsp;&nbsp;&nbsp; ries is used in the search for utility.&nbsp; Note that the -S option is also&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">&nbsp;&nbsp;&nbsp;&nbsp; required for this example to work correctly.&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><pre><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #!/usr/bin/env -S -P/usr/local/bin:/usr/bin perl&nbsp;</span></pre><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">&nbsp;&nbsp;&nbsp;&nbsp; The above finds `perl' only if it is in /usr/local/bin or /usr/bin.&nbsp; That&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">&nbsp;&nbsp;&nbsp;&nbsp; could be combined with the present value of PATH, to provide more flexi-&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">&nbsp;&nbsp;&nbsp;&nbsp; bility.&nbsp; Note that spaces are not required between the -S and -P options:&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><pre><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #!/usr/bin/env -S-P/usr/local/bin:/usr/bin:${PATH} perl&nbsp;</span></pre><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">这种写法主要是为了让你的程序在不同的系统上都能适用。&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">不管你的perl是在/usr/bin/perl还是/usr/local/bin/perl，#!/usr/bin/env perl会自动的在你的用户PATH变量中所定义的目录中寻找perl来执行的。&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">还可以加上-P参数来指定一些目录去寻找perl这个程序，&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">#!/usr/bin/env -S -P/usr/local/bin:/usr/bin perl的作用就是在/usr/local/bin和/usr/bin目录下寻找perl。&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">为了让程序更加的有可扩展性，可以写成&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">#!/usr/bin/env -S-P/usr/local/bin:/usr/bin:${PATH} perl，那么它除了在这两个目录寻找之外，还会在PATH变量中定义的目录中寻找。&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">同样的php也适用， #!/usr/bin/php写成&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">#!/usr/bin/env php会好些，当然更好的是&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><pre><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">#!/usr/bin/env -S-P/usr/local/bin:/usr/bin:${PATH} php</span></pre><p></p>